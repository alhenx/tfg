{"changed":false,"filter":false,"title":"simpletheme.js","tooltip":"/cockpit/src/plugins/openrov-simple-theme/public/js/simpletheme.js","value":"(function (window, $, undefined) {\n  'use strict';\n\n  var simpletheme;\n\n  simpletheme = function simpletheme(cockpit) {\n    console.log(\"Loading Simple Theme plugin in the browser.\");\n\n    this.cockpit = cockpit;\n\n    this.name = 'simpletheme';\n    this.viewName = 'Simple Theme';\n    this.canBeDisabled = true;\n    //this.validTelemetry = \"hdgd deap pitc roll yaw fthr servo starg fmem vout iout atmp cpuusage pres temp alps brdt sc1i sc2i sc3i brdi bt1i bt2i brdv avcc mtarg capa\";\n    this.validTelemetry = \"yaw gpsaltitud gpslatitud brujulax brujulay brujulaz valorph valororp valorec valortemp\";\n    this.telemetry = [];\n    this.telemetryRAW = [];\n    this.isInit = true;\n    $('#rov_status_panel').append('<div id=\"telemetry-graph\" class=\"\" ></div>');\n    var rov = this;\n\n\n    this.enable = function () {\n      jQuery('html').addClass('simpleTheme');\n    };\n    this.disable = function () {\n      jQuery('html').removeClass('simpleTheme');\n    };\n  };\n\n  simpletheme.prototype.listen = function listen() {\n    var rov = this;\n    rov.cockpit.socket.on('status', function (data) {\n      for (var i in data) {\n        var li = i.toLowerCase();\n        if(rov.validTelemetry.indexOf(li) != -1){\n          rov.telemetry[li] = parseFloat(data[i]);\n          rov.telemetryRAW[li] = (li == 'cpuusage'?parseFloat(data[i]).toFixed(2):data[i]);\n        }\n      }\n\n      if(rov.isInit){\n        var runInit = false;\n        for (var x in rov.telemetry) {\n          if(rov.telemetry[x] != undefined){\n            runInit = true;\n            break;\n          }\n        }\n\n        if(runInit){\n          rov.init();\n          rov.isInit = false;\n        }\n      }\n    });\n\n  };\n  simpletheme.prototype.init = function() {\n    var rov = this;\n    var line = function(header){\n      var t = -1;\n      var n = 100;\n      var v = 0;\n      var data = [];\n\n      function next () {\n        var dataNow = rov.telemetry[header];\n          return {\n              time: ++t,\n              value: v = (dataNow?dataNow:0)\n          };\n      }\n\n      var width = n,\n          height = 40;\n\n      var x = d3.scale.linear()\n          .domain([0, n - 1])\n          .range([0, width]);\n\n      var y = d3.scale.linear()\n          .domain([0, 20])\n          .range([height, 0]);\n\n      var line = d3.svg.line()\n          .x(function(d, i) { return x(d.time); })\n          .y(function(d, i) { return y(d.value); });\n      var main = d3.select(\"#telemetry-graph\").append(\"div\");\n\n      var title = main\n        .append('h1')\n        .html(header);\n      var status = main\n        .append('span')\n        .attr(\"class\", 'status')\n        .html(rov.telemetryRAW[header]);\n\n      var svg = main.append(\"svg\")\n          .attr(\"width\", width)\n          .attr(\"height\", height).attr(\"class\", header);\n\n      var path = svg.append(\"path\")\n        .data([data])\n        .attr(\"class\", \"line\")\n        .attr(\"d\", line);\n\n        tick();\n\n        function tick(){\n            data.push(next());\n            var maxList = [];\n            data.forEach(function(d){maxList[maxList.length] = d.value});\n\n            x.domain([t - n, t]);\n            y.domain([d3.min(maxList),  d3.max(maxList)]);\n\n            path\n                .attr(\"d\", line)\n                .attr(\"transform\", null)\n                .transition()\n                .duration(1000)\n                .ease(\"linear\")\n                .attr(\"transform\", \"translate(-\" + (width/n) + \")\")\n                .each(\"end\", tick);\n                console.log(header,rov.telemetryRAW,rov.telemetryRAW[header]);\n            status.html(rov.telemetryRAW[header]);\n            if(data.length > n){\n              data.shift();\n            }\n\n        }\n    }\n    var validArr = rov.validTelemetry.split(\" \");\n\n    for(var x in validArr){\n      new line(validArr[x]);\n    }\n  };\n\n  window.Cockpit.plugins.push(simpletheme);\n\n}(window, jQuery));\n","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":true},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1471878707000}